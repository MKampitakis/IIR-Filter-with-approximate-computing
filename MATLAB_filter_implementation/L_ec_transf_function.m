% left earcup filter implementation
clear all; clc;

b1 = [0.997688673703782,    -1.99537734740756,  0.997688673703782];
a1 = [1.000000000000000,    -1.99537200517118,  0.995382689643946];

b2 = [0.996840324347158,    -1.98539089742671,  0.988720680907831];
a2 = [1.000000000000000,    -1.98539089742671,  0.985561005254989];

b3 = [0.989346186734103,  -1.960750017843155,   0.972144876553493];
a3 = [1.000000000000000,  -1.960750017843155,   0.961491063287596];

b4 = [0.979704838449784,  -1.846591769676343,   0.938921295769681];
a4 = [1.000000000000000,  -1.846591769676343,   0.918626134219466];

b5 = [0.979200156266068,  -1.761924633312164,   0.908076593872015];
a5 = [1.000000000000000,  -1.761924633312164,   0.887276750138083];

b6 = [0.952368404985420,  -1.374237116171803,   0.875463937092621];
a6 = [1.000000000000000,  -1.374237116171803,   0.827832342078041];

b7 = [0.963162622458946,  -0.873868016377117,   0.784573410295288];
a7 = [1.000000000000000,  -0.873868016377117,   0.747736032754234];

b8 = [1.005674399766020,  -1.870348822300203,   0.901316722216608];
a8 = [1.000000000000000,  -1.870348822300203,   0.906991121982628];

b9 = [1.053519087055916,  -1.594350294014791,   0.808949105303846];
a9 = [1.000000000000000,  -1.594350294014791,   0.862468192359761];

b10 = [0.952639298115320,  -1.233493017023485,   0.586814240184512];
a10 = [1.000000000000000,  -1.233493017023485,   0.539453538299833];

b11 = [0.995478355661925,  -1.950963366681893,   0.960552124924331];
a11 = [1.000000000000000,  -1.950963366681893,   0.956030480586256];

b12 = [0.992463836436969,  -1.919959329420961,   0.934252759271458];
a12 = [1.000000000000000,  -1.919959329420961,   0.926716595708427];

b13 = [0.946277737939349,   -1.04481549985497,  0.531314512133168];
a13 = [1.000000000000000,   -1.04481549985497,  0.477592250072517];

%%
n = 8192; % resolution points
desiredFrequencyVector = logspace(log10(20),log10(20000),n); % range

% plot individual filters
h1 = fvtool(b1,a1,b2,a2,b3,a3,b4,a4,b5,a5,b6,a6,b7,a7,b8,a8,b9,a9,b10,a10,b11,a11,b12,a12,b13,a13);
h1.FrequencyScale = 'Log';
h1.FrequencyRange = 'Specify freq. vector';
h1.FrequencyVector = desiredFrequencyVector;

fil1 = dfilt.df2(b1,a1);
fil2 = dfilt.df2(b2,a2);
fil3 = dfilt.df2(b3,a3);
fil4 = dfilt.df2(b4,a4);
fil5 = dfilt.df2(b5,a5);
fil6 = dfilt.df2(b6,a6);
fil7 = dfilt.df2(b7,a7);
fil8 = dfilt.df2(b8,a8);
fil9 = dfilt.df2(b9,a9);
fil10 = dfilt.df2(b10,a10);
fil11 = dfilt.df2(b11,a11);
fil12 = dfilt.df2(b12,a12);
fil13 = dfilt.df2(b13,a13);

% plot cascaded filters
h2cas = dfilt.cascade(fil1, fil2, fil3, fil4, fil5, fil6, fil7, fil8, fil9, fil10, fil11, fil12, fil13);
h2 = fvtool(h2cas);
h2.FrequencyScale = 'Log';
h2.FrequencyRange = 'Specify freq. vector';
h2.FrequencyVector = desiredFrequencyVector;